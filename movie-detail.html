<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üé¨</text></svg>">

<!-- Meta tags will be dynamically generated by JavaScript -->

<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; }
body {
    margin: 0; font-family: 'Prompt', sans-serif; color: #fff;
    background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.9)), url("images/bg-cinema.jpg") center/cover fixed;
    transition: background 1s ease;
}
.loading-state { font-size: 24px; display: flex; align-items: center; justify-content: center; min-height: 100vh; }

/* --- Default Layout (Movie / Dubbed Series) --- */
.movie-layout {
    min-height: 100vh;
    display: flex; align-items: center; justify-content: center;
    padding: 40px;
}
.movie-container {
    max-width: 900px; width: 100%; display: flex; gap: 40px;
    background: rgba(255,255,255,0.06); border-radius: 22px; padding: 40px;
    box-shadow: 0 30px 60px rgba(0,0,0,0.7); backdrop-filter: blur(12px);
    transform: translateY(20px); opacity: 0; animation: slideUp 1.2s ease forwards 0.4s;
}
@keyframes slideUp { to { transform: translateY(0); opacity: 1; } }
.poster-card { flex: 1; }
.poster-card img { width: 100%; max-width: 320px; border-radius: 18px; box-shadow: 0 20px 40px rgba(0,0,0,0.8); }
.movie-info { flex: 1.6; }
.movie-info h1 { font-size: 34px; margin-bottom: 10px; }
.movie-info p { line-height: 1.9; font-size: 16px; margin-bottom: 30px; }
.buttons { display: flex; gap: 18px; flex-wrap: wrap; }
.btn { padding: 14px 30px; border-radius: 30px; border: none; font-size: 16px; cursor: pointer; text-decoration: none; display: inline-block; text-align: center; transition: all 0.3s ease; }
.btn-watch { background: #e50914; color: #fff; }
.btn-watch:hover { background: #ff1f2d; transform: translateY(-3px); }
.btn-back { background: transparent; color: #fff; border: 2px solid #fff; }
.btn-back:hover { background: #fff; color: #000; }

/* --- Vertical Series Layout --- */
.vertical-layout {
    padding: 40px 20px;
    max-width: 800px; margin: 0 auto;
    transform: translateY(20px); opacity: 0; animation: slideUp 1.2s ease forwards 0.4s;
}
.video-player-box {
    position: relative;
    padding-bottom: 177.77%; /* 9:16 aspect ratio for vertical video */
    height: 0;
    overflow: hidden;
    max-width: 100%;
    background: #000;
    border-radius: 20px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.7);
}
.video-player-box iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 0;
}
.vertical-info { text-align: center; margin-top: 30px; }
.vertical-info h1 { font-size: 28px; }
.vertical-info p { max-width: 600px; margin: 15px auto 30px; line-height: 1.8; color: #eee; }

@media (max-width: 768px) {
    .movie-container { flex-direction: column; text-align: center; }
    .vertical-layout { padding: 20px; }
}
</style>
</head>
<body>

<div id="content-container"></div>
<div id="loadingState" class="loading-state">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyAcCn0NGbakHmLEa_G47K8OepGaRqTV02Q",
      authDomain: "duydodeesport.firebaseapp.com",
      projectId: "duydodeesport",
      storageBucket: "duydodeesport.appspot.com",
      messagingSenderId: "435929814225",
      appId: "1:435929814225:web:fcb01803d9e5b77340e1f0",
      measurementId: "G-JD1MFCNLY0"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const createMetaTag = (attr, attrValue, content) => {
        let meta = document.head.querySelector(`[${attr}='${attrValue}']`);
        if (!meta) {
            meta = document.createElement('meta');
            meta.setAttribute(attr, attrValue);
            document.head.appendChild(meta);
        }
        meta.setAttribute('content', content);
    };

    function getYouTubeID(url) {
        const regex = /(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|watch\?v=|embed\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
        const match = url.match(regex);
        return match ? match[1] : null;
    }

    (async function() {
        const params = new URLSearchParams(window.location.search);
        const movieId = params.get("id");
        const contentContainer = document.getElementById('content-container');
        const loadingState = document.getElementById('loadingState');

        if (!movieId) { loadingState.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö ID ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤'; return; }

        try {
            const doc = await db.collection('movies').doc(movieId).get();

            if (doc.exists) {
                const content = doc.data();

                if (content.banner) { document.body.style.background = `linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.9)), url("${content.banner}") center/cover fixed`; }

                document.title = `${content.title} | DUYDODEE-HD`;
                createMetaTag('name', 'description', content.desc);
                createMetaTag('property', 'og:title', document.title);
                createMetaTag('property', 'og:description', content.desc);
                createMetaTag('property', 'og:image', content.banner || content.poster);

                // --- RENDER BASED ON CATEGORY ---
                if (content.category === 'chinese_series_vertical') {
                    const videoId = getYouTubeID(content.link);
                    if (videoId) {
                        contentContainer.innerHTML = `
                        <div class="vertical-layout">
                            <div class="video-player-box">
                                <iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&modestbranding=1&rel=0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                            <div class="vertical-info">
                                <h1>${content.title}</h1>
                                <p>${content.desc}</p>
                                <a href="index.html" class="btn btn-back">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                            </div>
                        </div>`;
                    } else {
                        loadingState.textContent = '‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                    }
                } else {
                    contentContainer.innerHTML = `
                    <div class="movie-layout">
                        <div class="movie-container">
                            <div class="poster-card">
                                <img src="${content.poster}" alt="Poster for ${content.title}">
                            </div>
                            <div class="movie-info">
                                <h1>${content.title}</h1>
                                <p>${content.desc}</p>
                                <div class="buttons">
                                    <a href="${content.link}" target="_blank" class="btn btn-watch">üé• ‡∏£‡∏±‡∏ö‡∏ä‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</a>
                                    <a href="index.html" class="btn btn-back">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                                </div>
                            </div>
                        </div>
                    </div>`;
                }

                loadingState.style.display = 'none';
            } else {
                loadingState.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
            }
        } catch (error) {
            console.error("Error fetching document:", error);
            loadingState.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        }
    })();
</script>

</body>
</html>
