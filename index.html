<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DUYDODEE-HD - ‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á-‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ü‡∏£‡∏µ</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üé¨</text></svg>">
<meta name="description" content="DUYDODEE-HD ‡πÄ‡∏ß‡πá‡∏ö‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ü‡∏£‡∏µ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏Ñ‡∏£ ‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡∏±‡∏á ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢ ‡πÅ‡∏•‡∏∞‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°">
<meta name="keywords" content="‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á, ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô, ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á, movie review, DUYDODEE-HD, ‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå, ‡∏´‡∏ô‡∏±‡∏á‡∏ü‡∏£‡∏µ">
<meta property="og:title" content="DUYDODEE-HD - ‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á-‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ü‡∏£‡∏µ">
<meta property="og:description" content="DUYDODEE-HD ‡πÄ‡∏ß‡πá‡∏ö‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ü‡∏£‡∏µ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏Ñ‡∏£ ‡∏°‡∏µ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà">
<meta property="og:image" content="https://images.pexels.com/photos/2531709/pexels-photo-2531709.jpeg">
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&family=Jura:wght@700&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; }
html { scroll-behavior: smooth; }
body { margin: 0; font-family: 'Prompt', sans-serif; background: #0d0d0d; color: #fff; }

.hero {
    height: 50vh; /* Adjusted height */
    background: linear-gradient(to top, rgba(0,0,0,1), rgba(0,0,0,0.4)), url("https://images.pexels.com/photos/2531709/pexels-photo-2531709.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2") center/cover;
    display: flex; align-items: center; justify-content: center; text-align: center; }

.neon-logo {
    font-family: 'Jura', sans-serif; font-weight: 700; font-size: clamp(3rem, 10vw, 6rem); color: #fff;
    text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px #ff00de, 0 0 30px #ff00de, 0 0 40px #ff00de, 0 0 55px #ff00de, 0 0 75px #ff00de;
    animation: flicker 2s infinite alternate; }

@keyframes flicker {
    0%, 18%, 22%, 25%, 53%, 57%, 100% { text-shadow: 0 0 4px #fff, 0 0 10px #fff, 0 0 18px #00aeff, 0 0 38px #00aeff, 0 0 70px #00aeff, 0 0 80px #00aeff, 0 0 100px #00aeff; }
    20%, 24%, 55% { text-shadow: none; } }

.quick-nav {
    background: #111;
    padding: 15px 50px;
    text-align: center;
    position: sticky;
    top: 0;
    z-index: 100;
    border-bottom: 1px solid #222;
    display: flex; 
    justify-content: center;
    gap: 30px;
}
.quick-nav a {
    color: #ccc;
    text-decoration: none;
    font-size: 16px;
    font-weight: 500;
    transition: color 0.3s ease;
}
.quick-nav a:hover {
    color: #e50914;
}

.main-content { padding: 0 50px 50px 50px; }
.section { margin-top: 50px; }
.section h2 { margin-bottom: 30px; font-size: 28px; padding-bottom: 10px; border-bottom: 2px solid #e50914; display: inline-block; }
.movie-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 30px; }
.movie-card { cursor: pointer; transition: transform 0.4s ease; text-decoration: none; color: #fff; }
.movie-card:hover { transform: scale(1.08); }
.movie-card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.7); }
.movie-title { margin-top: 10px; font-size: 15px; text-align: center; font-weight: 300; }
.empty-grid-message { color: #888; }

@media (max-width: 768px) {
    .hero { height: 40vh; }
    .quick-nav { padding: 15px 20px; gap: 15px; font-size: 14px; flex-wrap: wrap;}
    .main-content { padding: 0 20px 20px 20px; }
}
</style>
</head>
<body>

<main>
    <header class="hero">
        <div class="hero-content">
            <h1 class="neon-logo">DUYDODEE-HD</h1>
        </div>
    </header>

    <nav class="quick-nav">
        <a href="#movies_section">‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</a>
        <a href="#top_rated_section">‡∏´‡∏ô‡∏±‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</a>
        <a href="#dubbed_series_section">‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢</a>
        <a href="#vertical_series_section">‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á</a>
    </nav>

    <div class="main-content">
        <section id="movies_section" class="section">
            <h2>üé¨ ‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h2>
            <div class="movie-grid" id="movies_grid">
                <p class="empty-grid-message">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
        </section>

        <section id="top_rated_section" class="section">
            <h2>‚≠ê ‡∏´‡∏ô‡∏±‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</h2>
            <div class="movie-grid" id="top_rated_grid">
                 <p class="empty-grid-message">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö...</p>
            </div>
        </section>

        <section id="dubbed_series_section" class="section">
            <h2>üî• ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï</h2>
            <div class="movie-grid" id="dubbed_series_grid">
                 <p class="empty-grid-message">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
        </section>

        <section id="vertical_series_section" class="section">
            <h2>üì± ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á</h2>
            <div class="movie-grid" id="vertical_series_grid">
                 <p class="empty-grid-message">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
        </section>
    </div>
</main>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyAcCn0NGbakHmLEa_G47K8OepGaRqTV02Q",
      authDomain: "duydodeesport.firebaseapp.com",
      projectId: "duydodeesport",
      storageBucket: "duydodeesport.appspot.com",
      messagingSenderId: "435929814225",
      appId: "1:435929814225:web:fcb01803d9e5b77340e1f0",
      measurementId: "G-JD1MFCNLY0"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    
    const moviesGrid = document.getElementById('movies_grid');
    const topRatedGrid = document.getElementById('top_rated_grid');
    const dubbedSeriesGrid = document.getElementById('dubbed_series_grid');
    const verticalSeriesGrid = document.getElementById('vertical_series_grid');

    const createCard = (content) => {
        const card = document.createElement('a');
        card.className = 'movie-card';
        card.href = `movie-detail.html?id=${content.id}`;
        card.innerHTML = `
            <img src="${content.poster}" alt="${content.title} Poster">
            <div class="movie-title">${content.title}</div>
        `;
        return card;
    };

    const renderGrid = (gridElement, contentList, emptyMessage) => {
        gridElement.innerHTML = '';
        if (contentList.length > 0) {
            contentList.forEach(content => gridElement.appendChild(createCard(content)));
        } else {
            gridElement.innerHTML = `<p class="empty-grid-message">${emptyMessage}</p>`;
        }
    }

    async function loadAllContent() {
        const moviesPromise = db.collection('movies').orderBy('createdAt', 'desc').get();
        const ratingsPromise = db.collection('ratings').get();

        try {
            const [moviesSnapshot, ratingsSnapshot] = await Promise.all([moviesPromise, ratingsPromise]);

            // 1. Process all movies into a map
            const allMovies = {};
            moviesSnapshot.forEach(doc => {
                allMovies[doc.id] = { id: doc.id, ...doc.data() };
            });

            // 2. Process ratings to calculate averages
            const ratingsSummary = {};
            ratingsSnapshot.forEach(doc => {
                const rating = doc.data();
                if (!ratingsSummary[rating.movieId]) {
                    ratingsSummary[rating.movieId] = { total: 0, count: 0 };
                }
                ratingsSummary[rating.movieId].total += rating.rating;
                ratingsSummary[rating.movieId].count++;
            });

            Object.keys(ratingsSummary).forEach(movieId => {
                const summary = ratingsSummary[movieId];
                summary.avg = summary.total / summary.count;
            });

            // 3. Categorize and sort movies
            const categorized = { movie: [], chinese_series_dubbed: [], chinese_series_vertical: [] };
            const allMoviesList = Object.values(allMovies);

            allMoviesList.forEach(content => {
                if (categorized[content.category]) {
                    categorized[content.category].push(content);
                } else {
                    categorized.movie.push(content); // Fallback
                }
            });

            // 4. Create and sort top-rated list
            let topRatedMovies = allMoviesList
                .filter(movie => ratingsSummary[movie.id]) // Only movies with ratings
                .map(movie => ({ ...movie, rating: ratingsSummary[movie.id] }))
                .sort((a, b) => b.rating.avg - a.rating.avg || b.rating.count - a.rating.count); // Sort by avg, then by count

            // 5. Render all grids
            renderGrid(moviesGrid, categorized.movie, '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥');
            renderGrid(topRatedGrid, topRatedMovies.slice(0, 10), '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô');
            renderGrid(dubbedSeriesGrid, categorized.chinese_series_dubbed, '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢');
            renderGrid(verticalSeriesGrid, categorized.chinese_series_vertical, '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á');

        } catch (error) {
            console.error("Error loading content:", error);
            moviesGrid.innerHTML = '<p class="empty-grid-message">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
            topRatedGrid.innerHTML = '<p class="empty-grid-message">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
            dubbedSeriesGrid.innerHTML = '<p class="empty-grid-message">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
            verticalSeriesGrid.innerHTML = '<p class="empty-grid-message">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
        }
    }

    loadAllContent();

</script>

</body>
</html>
