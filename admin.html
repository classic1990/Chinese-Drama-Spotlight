<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | DUYDODEE-HD</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #00aeff; --bg: #070707; --card: #121212; --input: #1a1a1a; }
        body { margin: 0; font-family: 'Prompt', sans-serif; background: var(--bg); color: #fff; padding-bottom: 50px; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        
        /* Login Section */
        #loginSection { 
            background: var(--card); padding: 60px 20px; border-radius: 20px; 
            text-align: center; margin-top: 10vh; border: 1px solid #333;
        }
        .google-btn { 
            background: #fff; color: #000; border: none; padding: 12px 25px; 
            border-radius: 30px; font-weight: 600; cursor: pointer; 
            display: inline-flex; align-items: center; gap: 10px; transition: 0.3s; 
        }
        .google-btn:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(255,255,255,0.2); }

        /* Admin Content */
        #adminContent { display: none; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .form-card { background: var(--card); padding: 30px; border-radius: 15px; border: 1px solid #333; margin-top: 20px; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 8px; color: var(--primary); font-size: 14px; font-weight: 600; }
        .input-group input, .input-group textarea, .input-group select { 
            box-sizing: border-box; width: 100%; padding: 12px; border-radius: 8px; 
            border: 1px solid #333; background: var(--input); color: #fff; font-size: 16px; font-family: 'Prompt'; 
        }
        
        /* Episode Style */
        .episodes-area { background: #111; padding: 15px; border-radius: 10px; border: 1px dashed #444; margin-top: 5px; }
        .episode-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .btn-add-ep { background: #28a745; color: #fff; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-bottom: 10px; font-size: 14px; }
        .btn-remove-ep { background: #ff4444; color: #fff; border: none; padding: 0 12px; border-radius: 5px; cursor: pointer; }

        .btn { padding: 14px; border-radius: 8px; border: none; cursor: pointer; font-size: 16px; font-weight: 600; width: 100%; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: #000; margin-bottom: 10px; }
        .btn-primary:hover { opacity: 0.8; }
        .btn-cancel { background: #333; color: #fff; display: none; }

        /* Movie List */
        .movie-list-container { margin-top: 40px; }
        .movie-item { 
            display: flex; align-items: center; gap: 15px; background: var(--card); 
            padding: 15px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #222; 
        }
        .movie-item img { width: 50px; height: 70px; object-fit: cover; border-radius: 6px; background: #222; }
        .movie-info { flex-grow: 1; }
        .movie-info strong { display: block; font-size: 15px; margin-bottom: 4px; }
        .movie-info span { font-size: 12px; color: #888; }
        .action-btns { display: flex; gap: 10px; }
        .action-btns button { background: none; border: none; cursor: pointer; font-size: 18px; }
        .edit-btn { color: #ffc107; }
        .delete-btn { color: #ff4444; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginSection">
        <h1 style="margin-bottom: 10px;">DUYDODEE HD</h1>
        <p style="color: #888; margin-bottom: 30px;">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
        <button class="google-btn" onclick="loginWithGoogle()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
            Login with Google
        </button>
    </div>

    <div id="adminContent">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 id="adminTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡πÉ‡∏´‡∏°‡πà</h2>
            <button onclick="auth.signOut()" style="background:#ff4444; color:#fff; border:none; padding:5px 15px; border-radius:5px; cursor:pointer;">Logout</button>
        </div>

        <div class="form-card">
            <form id="movieForm">
                <input type="hidden" id="editId">
                <div class="input-group">
                    <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                    <select id="category" required>
                        <option value="vertical">üì± ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á</option>
                        <option value="series">üé¨ ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢</option>
                    </select>
                </div>
                <div class="input-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label><input type="text" id="title" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå..." required></div>
                <div class="input-group"><label>URL ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå</label><input type="url" id="poster" placeholder="https://..." required></div>
                
                <div class="input-group">
                    <label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö YouTube ‡∏ó‡∏∏‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö)</label>
                    <div id="episodesContainer" class="episodes-area">
                        </div>
                    <button type="button" class="btn-add-ep" onclick="addEpisodeInput()" style="margin-top:10px;"><i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≠‡∏ô (EP)</button>
                </div>

                <div class="input-group"><label>‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö (‡πÄ‡∏ä‡πà‡∏ô EP.01, ‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß)</label><input type="text" id="badge" placeholder="HD"></div>
                <div class="input-group"><label>‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠</label><textarea id="desc" rows="3" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠‡∏™‡∏±‡πâ‡∏ô‡πÜ..."></textarea></div>
                
                <button type="submit" class="btn btn-primary" id="submitBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button type="button" class="btn btn-cancel" id="cancelBtn" onclick="resetForm()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            </form>
        </div>

        <div class="movie-list-container">
            <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h3>
            <div id="movieList"></div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBuhTA1YwcsNyxR0NLYW6JrxUQ9U7vyVeo",
        authDomain: "classic-e8ab7.firebaseapp.com",
        projectId: "classic-e8ab7",
        appId: "1:596308927760:web:63043fd2786459082cb195"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const ADMIN_EMAIL = "duy.kan1234@gmail.com"; 

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ UI ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏≠‡∏ô (Episodes)
    function addEpisodeInput(value = "") {
        const container = document.getElementById('episodesContainer');
        const count = container.getElementsByClassName('episode-row').length + 1;
        const div = document.createElement('div');
        div.className = 'episode-row';
        div.innerHTML = `
            <input type="text" class="ep-link-input" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà ${count}..." value="${value}" required>
            ${count > 1 ? '<button type="button" class="btn-remove-ep" onclick="this.parentElement.remove()">‚úï</button>' : ''}
        `;
        container.appendChild(div);
    }

    // ‡∏£‡∏∞‡∏ö‡∏ö Login
    async function loginWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        try {
            const result = await auth.signInWithPopup(provider);
            if (result.user.email !== ADMIN_EMAIL) {
                alert("‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ");
                await auth.signOut();
            }
        } catch (e) { alert(e.message); }
    }

    auth.onAuthStateChanged(user => {
        if (user && user.email === ADMIN_EMAIL) {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
            resetForm(); // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°
            loadData();
        } else {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('adminContent').style.display = 'none';
        }
    });

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    document.getElementById('movieForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const id = document.getElementById('editId').value;
        const submitBtn = document.getElementById('submitBtn');
        
        // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å
        const linkInputs = document.getElementsByClassName('ep-link-input');
        const linksArray = Array.from(linkInputs).map(input => input.value.trim());

        submitBtn.disabled = true;
        submitBtn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";

        const data = {
            category: document.getElementById('category').value,
            title: document.getElementById('title').value,
            poster: document.getElementById('poster').value,
            links: linksArray, // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≤‡πÄ‡∏£‡∏¢‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏≠‡∏ô
            link: linksArray[0], // ‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏£‡∏Å‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Å‡πà‡∏≤
            badge: document.getElementById('badge').value || 'HD',
            desc: document.getElementById('desc').value,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        try {
            if (id) {
                await db.collection('movies').doc(id).update(data);
                alert("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
            } else {
                data.viewCount = 0;
                data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                await db.collection('movies').add(data);
                alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
            }
            resetForm();
        } catch (err) {
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message);
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        }
    });

    function loadData() {
        db.collection('movies').orderBy('createdAt', 'desc').onSnapshot(snap => {
            const list = document.getElementById('movieList');
            list.innerHTML = '';
            snap.forEach(doc => {
                const m = doc.data();
                const epCount = m.links ? m.links.length : 1;
                list.innerHTML += `
                    <div class="movie-item">
                        <img src="${m.poster}" onerror="this.src='logo.png'">
                        <div class="movie-info">
                            <strong>${m.title}</strong>
                            <span>${m.category === 'vertical' ? '‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á' : '‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢'} | ${epCount} ‡∏ï‡∏≠‡∏ô | ${m.viewCount || 0} views</span>
                        </div>
                        <div class="action-btns">
                            <button class="edit-btn" onclick="editDoc('${doc.id}')"><i class="fas fa-edit"></i></button>
                            <button class="delete-btn" onclick="deleteDoc('${doc.id}')"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>`;
            });
        });
    }

    async function editDoc(id) {
        const doc = await db.collection('movies').doc(id).get();
        if (doc.exists) {
            const m = doc.data();
            document.getElementById('editId').value = id;
            document.getElementById('category').value = m.category;
            document.getElementById('title').value = m.title;
            document.getElementById('poster').value = m.poster;
            document.getElementById('badge').value = m.badge;
            document.getElementById('desc').value = m.desc;

            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏≠‡∏ô
            const container = document.getElementById('episodesContainer');
            container.innerHTML = '';
            if (m.links && Array.isArray(m.links)) {
                m.links.forEach(url => addEpisodeInput(url));
            } else {
                addEpisodeInput(m.link || "");
            }

            document.getElementById('adminTitle').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: " + m.title;
            document.getElementById('cancelBtn').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }

    function resetForm() {
        document.getElementById('movieForm').reset();
        document.getElementById('editId').value = '';
        document.getElementById('adminTitle').innerText = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡πÉ‡∏´‡∏°‡πà";
        document.getElementById('cancelBtn').style.display = 'none';
        document.getElementById('episodesContainer').innerHTML = '';
        addEpisodeInput(); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏£‡∏Å‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    }

    async function deleteDoc(id) {
        if(confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) {
            await db.collection('movies').doc(id).delete();
        }
    }
</script>
</body>
</html>
