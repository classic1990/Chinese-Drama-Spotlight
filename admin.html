<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel | DUYDODEE-HD</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
<style>
    body { margin: 0; font-family: 'Prompt', sans-serif; background: #0f0f0f; color: #fff; padding: 20px; }
    .container { max-width: 900px; margin: 0 auto; }
    
    #loginSection { background: #1a1a1a; padding: 40px; border-radius: 20px; text-align: center; margin-top: 10vh; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    #adminContent { display: none; }

    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .form-card { background: #1a1a1a; padding: 25px; border-radius: 15px; border: 1px solid #333; margin-bottom: 40px; position: relative; }
    
    /* Edit Mode Highlight */
    .form-card.edit-mode { border-color: #00aeff; box-shadow: 0 0 15px rgba(0, 174, 255, 0.2); }
    .edit-label { display: none; color: #00aeff; font-weight: 600; margin-bottom: 10px; }
    .form-card.edit-mode .edit-label { display: block; }

    .input-group { margin-bottom: 15px; }
    .input-group label { display: block; margin-bottom: 8px; color: #aaa; font-size: 14px; }
    .input-group input, .input-group textarea, .input-group select { 
        box-sizing: border-box; width: 100%; padding: 12px; border-radius: 10px; 
        border: 1px solid #333; background: #222; color: #fff; font-size: 16px; 
        font-family: 'Prompt', sans-serif; 
    }
    
    .btn { padding: 12px 25px; border-radius: 10px; border: none; cursor: pointer; font-size: 16px; font-weight: 600; width: 100%; transition: 0.3s; }
    .btn-primary { background: #00aeff; color: #000; }
    .btn-primary:hover { background: #008ecc; }
    .btn-secondary { background: #333; color: #fff; margin-top: 10px; }
    
    .btn-google { 
        background: #fff; color: #444; margin-top: 15px; 
        display: flex; align-items: center; justify-content: center; gap: 10px;
    }
    .btn-google:hover { background: #f1f1f1; }
    .btn-google img { width: 20px; }

    .divider { margin: 20px 0; color: #555; font-size: 14px; position: relative; }
    .divider::before, .divider::after { content: ""; position: absolute; top: 50%; width: 40%; height: 1px; background: #333; }
    .divider::before { left: 0; }
    .divider::after { right: 0; }

    .action-btns { display: flex; gap: 5px; }
    .btn-danger { background: #ff4444; color: #fff; padding: 6px 12px; font-size: 13px; border-radius: 6px; }
    .btn-edit { background: #ffcc00; color: #000; padding: 6px 12px; font-size: 13px; border-radius: 6px; }
    
    .movie-item { display: flex; align-items: center; gap: 15px; background: #1a1a1a; padding: 12px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #222; }
    .movie-item img { width: 45px; height: 65px; object-fit: cover; border-radius: 4px; background: #333; }
    .movie-item-info { flex-grow: 1; }
    .movie-item-info h3 { margin: 0; font-size: 15px; line-height: 1.2; margin-bottom: 5px; }
    .badge { font-size: 10px; background: #333; color: #00aeff; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; }
    .url-warning { font-size: 11px; color: #ffcc00; display: block; margin-top: 5px; }
</style>
</head>
<body>

<div class="container">
    <!-- Login -->
    <div id="loginSection">
        <h1 style="color: #00aeff;">ADMIN LOGIN</h1>
        <p style="color: #888; margin-bottom: 25px;">‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö DUYDODEE-HD</p>
        <button class="btn btn-google" onclick="handleGoogleLogin()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google
        </button>
        <div class="divider">‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>
        <div class="input-group">
            <input type="email" id="loginEmail" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô">
        </div>
        <div class="input-group">
            <input type="password" id="loginPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
        </div>
        <button class="btn btn-primary" onclick="handleLogin()">‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
    </div>

    <!-- Admin Content -->
    <div id="adminContent">
        <div class="header">
            <h2>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏ß‡πá‡∏ö</h2>
            <div style="text-align: right;">
                <span id="adminEmail" style="display: block; font-size: 12px; color: #00aeff; font-weight: 600;"></span>
                <button onclick="auth.signOut()" style="background:none; border:1px solid #444; color:#aaa; cursor:pointer; padding:5px 10px; border-radius:5px; margin-top: 5px;">Logout</button>
            </div>
        </div>

        <div class="form-card" id="formCard">
            <div class="edit-label">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
            <form id="movieForm">
                <input type="hidden" id="editId">
                <div class="input-group">
                    <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                    <select id="category" required>
                        <option value="vertical">üì± ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á</option>
                        <option value="series">üé¨ ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢</option>
                        <option value="movie">üé• ‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
                    <input type="text" id="title" required>
                </div>
                <div class="input-group">
                    <label>URL ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå</label>
                    <input type="url" id="poster" required>
                </div>
                <div class="input-group">
                    <label>URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube ‡∏õ‡∏Å‡∏ï‡∏¥)</label>
                    <input type="url" id="videoUrl" required>
                </div>
                <div class="input-group">
                    <label>Badge (‡πÄ‡∏ä‡πà‡∏ô EP.10 ‡∏´‡∏£‡∏∑‡∏≠ ‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß)</label>
                    <input type="text" id="badge">
                </div>
                <div class="input-group">
                    <label>‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠</label>
                    <textarea id="desc" rows="2"></textarea>
                </div>
                <button type="submit" class="btn btn-primary" id="submitBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button type="button" class="btn btn-secondary" id="cancelBtn" style="display:none;" onclick="resetForm()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            </form>
        </div>

        <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <div id="movieListContainer">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyAcCn0NGbakHmLEa_G47K8OepGaRqTV02Q",
      authDomain: "duydodeesport.firebaseapp.com",
      projectId: "duydodeesport",
      storageBucket: "duydodeesport.appspot.com",
      messagingSenderId: "435929814225",
      appId: "1:435929814225:web:fcb01803d9e5b77340e1f0"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // Helper: Format YouTube URL
    function formatVideoUrl(url) {
        if (!url) return "";
        if (url.includes('youtube.com/watch?v=')) {
            const videoId = url.split('v=')[1].split('&')[0];
            return `https://www.youtube.com/embed/${videoId}`;
        } else if (url.includes('youtu.be/')) {
            const videoId = url.split('youtu.be/')[1].split('?')[0];
            return `https://www.youtube.com/embed/${videoId}`;
        }
        return url;
    }

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
            document.getElementById('adminEmail').innerText = "‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô: " + user.email;
            loadData();
        } else {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('adminContent').style.display = 'none';
        }
    });

    async function handleGoogleLogin() {
        const provider = new firebase.auth.GoogleAuthProvider();
        try { await auth.signInWithPopup(provider); } catch (err) { alert(err.message); }
    }

    async function handleLogin() {
        const email = document.getElementById('loginEmail').value;
        const pass = document.getElementById('loginPassword').value;
        try { await auth.signInWithEmailAndPassword(email, pass); } catch (err) { alert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!'); }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
    function resetForm() {
        document.getElementById('movieForm').reset();
        document.getElementById('editId').value = '';
        document.getElementById('submitBtn').innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        document.getElementById('cancelBtn').style.display = 'none';
        document.getElementById('formCard').classList.remove('edit-mode');
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏´‡∏£‡∏∑‡∏≠ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
    document.getElementById('movieForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const editId = document.getElementById('editId').value;
        btn.disabled = true;

        const data = {
            category: document.getElementById('category').value,
            title: document.getElementById('title').value,
            poster: document.getElementById('poster').value,
            videoUrl: formatVideoUrl(document.getElementById('videoUrl').value),
            badge: document.getElementById('badge').value,
            description: document.getElementById('desc').value,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        try {
            if (editId) {
                // ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                await db.collection('movies').doc(editId).update(data);
                alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
            } else {
                // ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
                data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                await db.collection('movies').add(data);
                alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
            }
            resetForm();
        } catch (err) {
            alert('‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + err.message);
        } finally {
            btn.disabled = false;
        }
    });

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    function loadData() {
        db.collection('movies').orderBy('createdAt', 'desc').onSnapshot(snap => {
            const container = document.getElementById('movieListContainer');
            container.innerHTML = '';
            snap.forEach(doc => {
                const m = doc.data();
                const div = document.createElement('div');
                div.className = 'movie-item';
                div.innerHTML = `
                    <img src="${m.poster}" onerror="this.src='https://via.placeholder.com/50x75'">
                    <div class="movie-item-info">
                        <h3>${m.title}</h3>
                        <span class="badge">${m.category}</span>
                    </div>
                    <div class="action-btns">
                        <button class="btn-edit" onclick='startEdit("${doc.id}", ${JSON.stringify(m).replace(/'/g, "&apos;")})'>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button class="btn-danger" onclick="deleteItem('${doc.id}')">‡∏•‡∏ö</button>
                    </div>
                `;
                container.appendChild(div);
            });
        });
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏™‡πà‡∏ü‡∏≠‡∏£‡πå‡∏°)
    window.startEdit = (id, data) => {
        document.getElementById('editId').value = id;
        document.getElementById('category').value = data.category;
        document.getElementById('title').value = data.title;
        document.getElementById('poster').value = data.poster;
        document.getElementById('videoUrl').value = data.videoUrl;
        document.getElementById('badge').value = data.badge || '';
        document.getElementById('desc').value = data.description || '';
        
        document.getElementById('submitBtn').innerText = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á';
        document.getElementById('cancelBtn').style.display = 'block';
        document.getElementById('formCard').classList.add('edit-mode');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    window.deleteItem = async (id) => {
        if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?')) {
            try { await db.collection('movies').doc(id).delete(); } catch (err) { alert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'); }
        }
    }
</script>
</body>
</html>
