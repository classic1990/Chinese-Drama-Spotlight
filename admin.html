<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | DUYDODEE-HD</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #00e5ff;
            --primary-dark: #00b8cc;
            --bg-dark: #0a0a0c;
            --card-bg: #16161a;
            --input-bg: #1f1f23;
            --text-main: #ffffff;
            --text-dim: #9ca3af;
            --success: #10b981;
            --error: #ef4444;
            --ai-color: #a855f7;
            --glass-border: rgba(255, 255, 255, 0.05);
        }

        * { box-sizing: border-box; }

        body { 
            margin: 0; 
            font-family: 'Prompt', sans-serif; 
            background: var(--bg-dark); 
            color: var(--text-main);
            background-image: radial-gradient(circle at 0% 0%, rgba(0, 229, 255, 0.05) 0%, transparent 40%);
            min-height: 100vh;
        }
        
        /* --- AI Toast Notification --- */
        #aiLoading { 
            position: fixed; top: 30px; left: 50%; transform: translateX(-50%);
            background: var(--ai-color); color: white; padding: 12px 25px; 
            border-radius: 50px; z-index: 2000; display: none; 
            box-shadow: 0 10px 30px rgba(168, 85, 247, 0.4);
            font-weight: 600; font-size: 14px;
            animation: slideDown 0.3s ease;
        }
        @keyframes slideDown { from { top: -50px; } to { top: 30px; } }

        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        
        .header-box {
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 40px; border-bottom: 1px solid var(--glass-border);
            padding-bottom: 20px;
        }
        .header-box h2 { font-size: 24px; font-weight: 700; margin: 0; display: flex; align-items: center; gap: 15px; }
        .header-box h2 i { background: var(--ai-color); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* --- Grid Layout --- */
        .form-grid { display: grid; grid-template-columns: 1.6fr 1fr; gap: 25px; }
        @media (max-width: 900px) { .form-grid { grid-template-columns: 1fr; } }

        .card { 
            background: var(--card-bg); padding: 30px; border-radius: 20px; 
            border: 1px solid var(--glass-border); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .card-title { font-size: 16px; font-weight: 600; margin-bottom: 20px; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        
        /* --- Form Elements --- */
        .input-group { margin-bottom: 20px; }
        .input-group label { 
            display: flex; justify-content: space-between; margin-bottom: 10px; 
            color: var(--text-dim); font-size: 14px; font-weight: 500; 
        }
        
        .input-group input, .input-group select, .input-group textarea {
            width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--glass-border);
            background: var(--input-bg); color: #fff; box-sizing: border-box; 
            font-family: 'Prompt'; font-size: 15px; transition: 0.3s;
        }
        .input-group input:focus, .input-group textarea:focus {
            border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(0, 229, 255, 0.1);
        }

        .ai-btn { 
            background: rgba(168, 85, 247, 0.15); color: var(--ai-color); 
            border: 1px solid var(--ai-color); padding: 4px 12px; border-radius: 6px; 
            font-size: 11px; cursor: pointer; font-weight: 600; transition: 0.2s;
        }
        .ai-btn:hover { background: var(--ai-color); color: white; }

        .main-save-btn { 
            background: var(--primary); color: #000; padding: 16px; border-radius: 12px; 
            font-weight: 700; border: none; cursor: pointer; width: 100%; 
            margin-top: 10px; font-size: 16px; transition: 0.3s;
            box-shadow: 0 4px 15px rgba(0, 229, 255, 0.3);
        }
        .main-save-btn:hover { background: #fff; transform: translateY(-2px); }

        /* --- Episode Section --- */
        .episodes-area { 
            background: #000; padding: 15px; border-radius: 12px; 
            border: 1px dashed #333; max-height: 300px; overflow-y: auto; 
        }
        .episode-row { 
            display: flex; gap: 10px; margin-bottom: 10px; 
            background: var(--input-bg); padding: 8px; border-radius: 10px; align-items: center; 
        }
        .episode-row input { padding: 8px 12px; border-radius: 8px; }

        /* --- Table List --- */
        .table-container { margin-top: 50px; }
        .table-container h3 { margin-bottom: 20px; font-size: 20px; color: var(--text-main); }
        
        .movie-table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        .movie-row { 
            background: var(--card-bg); border-radius: 15px; transition: 0.3s;
        }
        .movie-row:hover { background: #1f1f23; }
        .movie-row td { 
            padding: 15px; 
            border-top: 1px solid var(--glass-border); 
            border-bottom: 1px solid var(--glass-border);
        }
        .movie-row td:first-child { border-left: 1px solid var(--glass-border); border-top-left-radius: 15px; border-bottom-left-radius: 15px; }
        .movie-row td:last-child { border-right: 1px solid var(--glass-border); border-top-right-radius: 15px; border-bottom-right-radius: 15px; }

        .poster-mini { width: 45px; height: 60px; object-fit: cover; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        
        .action-btn { 
            padding: 8px; border-radius: 8px; cursor: pointer; font-size: 14px; 
            transition: 0.2s; display: inline-flex; align-items: center; justify-content: center;
        }
        .btn-edit { color: var(--primary); background: rgba(0, 229, 255, 0.1); margin-right: 10px; }
        .btn-delete { color: var(--error); background: rgba(239, 68, 68, 0.1); }
        .action-btn:hover { transform: scale(1.1); }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body>

<div id="aiLoading"><i class="fas fa-magic fa-spin"></i> Gemini AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</div>

<div class="container">
    <div class="header-box">
        <h2><i class="fas fa-bolt"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå</h2>
        <a href="index.html" style="color:var(--primary); text-decoration:none; font-weight:600; font-size:14px;"><i class="fas fa-external-link-alt"></i> ‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</a>
    </div>

    <form id="movieForm">
        <div class="form-grid">
            <!-- Left Side -->
            <div class="card">
                <div class="card-title"><i class="fas fa-info-circle"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</div>
                <input type="hidden" id="editId">
                <div class="input-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
                    <input type="text" id="title" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå..." required>
                </div>
                <div class="input-group">
                    <label>‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠ <button type="button" class="ai-btn" onclick="aiAction('desc')">AI ‡πÄ‡∏à‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</button></label>
                    <textarea id="desc" rows="6" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô..."></textarea>
                </div>
                <div class="input-group" style="margin-bottom:0;">
                    <label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏≠‡∏ô)</label>
                    <div id="episodesContainer" class="episodes-area"></div>
                    <button type="button" class="ai-btn" style="width:100%; margin-top:15px; background:rgba(255,255,255,0.05); border-color:#444; color:#fff; padding:10px;" onclick="addEpisodeInput()">
                        <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà
                    </button>
                </div>
            </div>

            <!-- Right Side -->
            <div class="card">
                <div class="card-title"><i class="fas fa-cog"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ</div>
                <div class="input-group">
                    <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</label>
                    <select id="category">
                        <option value="vertical">üì± ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏™‡∏±‡πâ‡∏ô (‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á)</option>
                        <option value="series">üé¨ ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏¢‡∏≤‡∏ß (‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>URL ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå</label>
                    <input type="url" id="poster" placeholder="https://..." required>
                </div>
                <div class="input-group">
                    <label>‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö <button type="button" class="ai-btn" onclick="aiAction('badge')">AI ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</button></label>
                    <input type="text" id="badge" placeholder="‡πÄ‡∏ä‡πà‡∏ô HD, ‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß, ‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà">
                </div>
                
                <div style="margin-top:30px;">
                    <button type="submit" class="main-save-btn" id="submitBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå</button>
                    <button type="button" id="cancelBtn" onclick="resetForm()" style="display:none; width:100%; margin-top:15px; background:transparent; color:var(--text-dim); border:1px solid #333; padding:12px; border-radius:12px; cursor:pointer; font-family:'Prompt';">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                </div>
            </div>
        </div>
    </form>

    <div class="table-container">
        <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
        <table class="movie-table">
            <tbody id="movieList"></tbody>
        </table>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<script>
    /* --- Logic ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ï‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö --- */
    const firebaseConfig = {
        apiKey: "AIzaSyBuhTA1YwcsNyxR0NLYW6JrxUQ9U7vyVeo",
        authDomain: "classic-e8ab7.firebaseapp.com",
        projectId: "classic-e8ab7",
        appId: "1:596308927760:web:63043fd2786459082cb195"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const COLLECTION_NAME = "artifacts";
    const geminiKey = "AQ.Ab8RN6I36WcxxlrCTmyr6ChGTr0mpGkfaBMq9nJyVNIqzX90ww";

    async function aiAction(type) {
        const title = document.getElementById('title').value;
        if(!title) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ AI ‡∏Ñ‡∏£‡∏±‡∏ö");
        
        document.getElementById('aiLoading').style.display = 'block';
        const prompt = type === 'desc' ? `‡∏Ç‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ${title} ‡∏™‡∏±‡πâ‡∏ô‡πÜ 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î` : `‡∏Ç‡∏≠‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö 1 ‡∏Ñ‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ${title} (‡πÄ‡∏ä‡πà‡∏ô ‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß, ‡∏™‡∏ô‡∏∏‡∏Å‡∏°‡∏≤‡∏Å, ‡πÅ‡∏≠‡∏Ñ‡∏ä‡∏±‡πà‡∏ô)`;
        
        try {
            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${geminiKey}`, {
                method: 'POST', body: JSON.stringify({contents: [{parts: [{text: prompt}]}]})
            });
            const data = await res.json();
            const result = data.candidates[0].content.parts[0].text.trim();
            if(type === 'desc') document.getElementById('desc').value = result;
            else document.getElementById('badge').value = result.replace(/[^\u0E00-\u0E7F]/g, "").substring(0, 10);
        } catch(e) { alert("AI ‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß"); }
        finally { document.getElementById('aiLoading').style.display = 'none'; }
    }

    function addEpisodeInput(value = "") {
        const container = document.getElementById('episodesContainer');
        const div = document.createElement('div');
        div.className = 'episode-row';
        div.innerHTML = `
            <input type="text" class="ep-link-input" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (YouTube/Embed)..." value="${value}" required>
            <button type="button" onclick="this.parentElement.remove()" style="color:var(--error); background:none; border:none; cursor:pointer; font-size:20px;">&times;</button>
        `;
        container.appendChild(div);
    }

    document.getElementById('movieForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const id = document.getElementById('editId').value;
        const links = Array.from(document.getElementsByClassName('ep-link-input')).map(i => i.value.trim());
        
        const data = {
            title: document.getElementById('title').value,
            desc: document.getElementById('desc').value,
            category: document.getElementById('category').value,
            poster: document.getElementById('poster').value,
            badge: document.getElementById('badge').value || "HD",
            links: links,
            link: links[0],
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        try {
            if(id) await db.collection(COLLECTION_NAME).doc(id).update(data);
            else {
                data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                data.viewCount = 0;
                await db.collection(COLLECTION_NAME).add(data);
            }
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
            resetForm();
        } catch(e) { alert(e.message); }
    });

    function loadData() {
        db.collection(COLLECTION_NAME).orderBy('createdAt', 'desc').onSnapshot(snap => {
            const list = document.getElementById('movieList');
            list.innerHTML = '';
            snap.forEach(doc => {
                const m = doc.data();
                list.innerHTML += `
                    <tr class="movie-row">
                        <td width="60"><img src="${m.poster}" class="poster-mini"></td>
                        <td>
                            <div style="font-weight:600; color:#fff;">${m.title}</div>
                            <div style="font-size:12px; color:var(--text-dim); margin-top:4px;">
                                <span style="color:var(--primary)">${m.category === 'vertical' ? '‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á' : '‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢'}</span> &bull; ${m.links?.length || 1} ‡∏ï‡∏≠‡∏ô
                            </div>
                        </td>
                        <td align="right">
                            <div class="action-btn btn-edit" onclick="editDoc('${doc.id}')"><i class="fas fa-pen"></i></div>
                            <div class="action-btn btn-delete" onclick="deleteDoc('${doc.id}')"><i class="fas fa-trash"></i></div>
                        </td>
                    </tr>`;
            });
        });
    }

    async function editDoc(id) {
        const doc = await db.collection(COLLECTION_NAME).doc(id).get();
        const m = doc.data();
        document.getElementById('editId').value = id;
        document.getElementById('title').value = m.title;
        document.getElementById('desc').value = m.desc || '';
        document.getElementById('category').value = m.category;
        document.getElementById('poster').value = m.poster;
        document.getElementById('badge').value = m.badge || '';
        document.getElementById('episodesContainer').innerHTML = '';
        if(m.links) m.links.forEach(l => addEpisodeInput(l));
        else if(m.link) addEpisodeInput(m.link);
        else addEpisodeInput();
        
        document.getElementById('submitBtn').innerText = "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        document.getElementById('cancelBtn').style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function resetForm() {
        document.getElementById('movieForm').reset();
        document.getElementById('editId').value = '';
        document.getElementById('episodesContainer').innerHTML = '';
        addEpisodeInput();
        document.getElementById('submitBtn').innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå";
        document.getElementById('cancelBtn').style.display = 'none';
    }

    async function deleteDoc(id) {
        if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) await db.collection(COLLECTION_NAME).doc(id).delete();
    }

    loadData();
    resetForm();
</script>
</body>
</html>
