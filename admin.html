<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | DUYDODEE-HD</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #00aeff; --bg: #0f0f0f; --card: #1a1a1a; }
        body { margin: 0; font-family: 'Prompt', sans-serif; background: var(--bg); color: #fff; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        
        /* Login Section */
        #loginSection { 
            background: var(--card); padding: 50px 20px; border-radius: 20px; 
            text-align: center; margin-top: 15vh; box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
        }
        .google-btn {
            background: #fff; color: #444; border: none; padding: 12px 25px;
            border-radius: 10px; font-weight: 600; cursor: pointer;
            display: inline-flex; align-items: center; gap: 10px; font-size: 16px;
            transition: 0.3s; box-shadow: 0 4px 15px rgba(255,255,255,0.1);
        }
        .google-btn:hover { transform: translateY(-2px); background: #f1f1f1; }

        /* Admin Content */
        #adminContent { display: none; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        
        .form-card { background: var(--card); padding: 25px; border-radius: 15px; border: 1px solid #333; margin-bottom: 40px; }
        .form-card.edit-mode { border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 174, 255, 0.2); }
        .edit-label { display: none; color: var(--primary); font-weight: 600; margin-bottom: 10px; }
        .form-card.edit-mode .edit-label { display: block; }

        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 8px; color: #aaa; font-size: 14px; }
        .input-group input, .input-group textarea, .input-group select { 
            box-sizing: border-box; width: 100%; padding: 12px; border-radius: 10px; 
            border: 1px solid #333; background: #222; color: #fff; font-size: 16px; font-family: 'Prompt', sans-serif; 
        }

        .btn { padding: 12px 25px; border-radius: 10px; border: none; cursor: pointer; font-size: 16px; font-weight: 600; width: 100%; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: #000; }
        .btn-secondary { background: #333; color: #fff; margin-top: 10px; }
        
        /* Movie List */
        .movie-item { display: flex; align-items: center; gap: 15px; background: var(--card); padding: 12px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #222; }
        .movie-item img { width: 50px; height: 70px; object-fit: cover; border-radius: 6px; }
        .movie-item-info { flex-grow: 1; }
        .btn-edit { background: #ffcc00; color: #000; padding: 8px 15px; border-radius: 8px; border:none; cursor:pointer; margin-right:5px; }
        .btn-danger { background: #ff4444; color: #fff; padding: 8px 15px; border-radius: 8px; border:none; cursor:pointer; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginSection">
        <h1 style="color: var(--primary); margin-bottom: 30px;">ADMIN ACCESS</h1>
        <p style="color: #888; margin-bottom: 30px;">‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ</p>
        <button class="google-btn" onclick="loginWithGoogle()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google
        </button>
    </div>

    <div id="adminContent">
        <div class="header">
            <div>
                <h2 style="margin:0;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</h2>
                <small id="userEmail" style="color:var(--primary)"></small>
            </div>
            <button onclick="auth.signOut()" style="background:none; border:1px solid #444; color:#aaa; cursor:pointer; padding:8px 15px; border-radius:8px;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>

        <div class="form-card" id="formCard">
            <div class="edit-label"><i class="fas fa-edit"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
            <form id="movieForm">
                <input type="hidden" id="editId">
                <div class="input-group">
                    <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                    <select id="category" required>
                        <option value="vertical">üì± ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á</option>
                        <option value="series">üé¨ ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢</option>
                        <option value="movie">üé• ‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
                    <input type="text" id="title" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á" required>
                </div>
                <div class="input-group">
                    <label>URL ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå</label>
                    <input type="url" id="poster" required placeholder="https://...">
                </div>
                <div class="input-group">
                    <label>URL ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (YouTube/Embed)</label>
                    <input type="text" id="videoUrl" required placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube ‡∏´‡∏£‡∏∑‡∏≠ Code ‡∏ù‡∏±‡∏á">
                </div>
                <div class="input-group">
                    <label>‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠</label>
                    <textarea id="desc" rows="4" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary" id="submitBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button type="button" class="btn btn-secondary" id="cancelBtn" style="display:none;" onclick="resetForm()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            </form>
        </div>

        <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <div id="movieListContainer">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBuhTA1YwcsNyxR0NLYW6JrxUQ9U7vyVeo",
        authDomain: "classic-e8ab7.firebaseapp.com",
        projectId: "classic-e8ab7",
        storageBucket: "classic-e8ab7.firebasestorage.app",
        messagingSenderId: "596308927760",
        appId: "1:596308927760:web:63043fd2786459082cb195"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
    const ADMIN_EMAIL = "duy.kan1234@gmail.com"; 

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
    async function loginWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        try {
            const result = await auth.signInWithPopup(provider);
            if (result.user.email !== ADMIN_EMAIL) {
                alert("‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô");
                await auth.signOut();
            }
        } catch (error) {
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message);
        }
    }

    // ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
    auth.onAuthStateChanged(user => {
        if (user && user.email === ADMIN_EMAIL) {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
            document.getElementById('userEmail').innerText = "Logged in as: " + user.email;
            loadData();
        } else {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('adminContent').style.display = 'none';
        }
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö URL ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
    function formatVideoUrl(url) {
        if (!url) return "";
        let videoId = "";
        if (url.includes('youtu.be/')) videoId = url.split('youtu.be/')[1].split('?')[0];
        else if (url.includes('v=')) videoId = url.split('v=')[1].split('&')[0];
        else if (url.includes('/shorts/')) videoId = url.split('/shorts/')[1].split('?')[0];
        else if (url.includes('embed/')) return url;
        
        return videoId ? `https://www.youtube.com/embed/${videoId}?autoplay=1` : url;
    }

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    document.getElementById('movieForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const editId = document.getElementById('editId').value;
        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";

        const data = {
            category: document.getElementById('category').value,
            title: document.getElementById('title').value,
            poster: document.getElementById('poster').value,
            videoUrl: formatVideoUrl(document.getElementById('videoUrl').value),
            description: document.getElementById('desc').value,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        try {
            if (editId) {
                await db.collection('movies').doc(editId).update(data);
                alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
            } else {
                data.views = 0;
                data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                await db.collection('movies').add(data);
                alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            }
            resetForm();
        } catch (err) {
            alert("Error: " + err.message);
        } finally {
            btn.disabled = false;
        }
    });

    // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á
    function loadData() {
        db.collection('movies').orderBy('createdAt', 'desc').onSnapshot(snap => {
            const container = document.getElementById('movieListContainer');
            container.innerHTML = '';
            snap.forEach(doc => {
                const m = doc.data();
                const div = document.createElement('div');
                div.className = 'movie-item';
                div.innerHTML = `
                    <img src="${m.poster}" onerror="this.src='logo.png'">
                    <div class="movie-item-info">
                        <strong>${m.title}</strong><br>
                        <small style="color:#888">${m.category} | üëÄ ${m.views || 0}</small>
                    </div>
                    <div>
                        <button class="btn-edit" onclick='prepareEdit("${doc.id}", ${JSON.stringify(m).replace(/'/g, "&apos;")})'>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button class="btn-danger" onclick="deleteItem('${doc.id}')">‡∏•‡∏ö</button>
                    </div>
                `;
                container.appendChild(div);
            });
        });
    }

    // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    window.prepareEdit = (id, data) => {
        document.getElementById('editId').value = id;
        document.getElementById('category').value = data.category;
        document.getElementById('title').value = data.title;
        document.getElementById('poster').value = data.poster;
        document.getElementById('videoUrl').value = data.videoUrl;
        document.getElementById('desc').value = data.description || '';
        
        document.getElementById('submitBtn').innerText = "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        document.getElementById('cancelBtn').style.display = "block";
        document.getElementById('formCard').classList.add('edit-mode');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    function resetForm() {
        document.getElementById('movieForm').reset();
        document.getElementById('editId').value = '';
        document.getElementById('submitBtn').innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        document.getElementById('cancelBtn').style.display = "none";
        document.getElementById('formCard').classList.remove('edit-mode');
    }

    window.deleteItem = async (id) => {
        if (confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏≤‡∏ß‡∏£?")) {
            await db.collection('movies').doc(id).delete();
        }
    };
</script>
</body>
</html>
