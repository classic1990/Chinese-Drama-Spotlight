<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel | DUYDODEE-HD</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
<style>
    body { margin: 0; font-family: 'Prompt', sans-serif; background: #0f0f0f; color: #fff; padding: 20px; }
    .container { max-width: 900px; margin: 0 auto; }
    
    #loginSection { background: #1a1a1a; padding: 40px; border-radius: 20px; text-align: center; margin-top: 10vh; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    #adminContent { display: none; }

    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .form-card { background: #1a1a1a; padding: 25px; border-radius: 15px; border: 1px solid #333; margin-bottom: 40px; }
    
    .input-group { margin-bottom: 15px; }
    .input-group label { display: block; margin-bottom: 8px; color: #aaa; font-size: 14px; }
    .input-group input, .input-group textarea, .input-group select { 
        box-sizing: border-box; width: 100%; padding: 12px; border-radius: 10px; 
        border: 1px solid #333; background: #222; color: #fff; font-size: 16px; 
        font-family: 'Prompt', sans-serif; 
    }
    
    .btn { padding: 12px 25px; border-radius: 10px; border: none; cursor: pointer; font-size: 16px; font-weight: 600; width: 100%; transition: 0.3s; }
    .btn-primary { background: #00aeff; color: #000; }
    .btn-primary:hover { background: #008ecc; }
    
    .btn-google { 
        background: #fff; color: #444; margin-top: 15px; 
        display: flex; align-items: center; justify-content: center; gap: 10px;
    }
    .btn-google:hover { background: #f1f1f1; }
    .btn-google img { width: 20px; }

    .divider { margin: 20px 0; color: #555; font-size: 14px; position: relative; }
    .divider::before, .divider::after { content: ""; position: absolute; top: 50%; width: 40%; height: 1px; background: #333; }
    .divider::before { left: 0; }
    .divider::after { right: right; }

    .btn-danger { background: #ff4444; color: #fff; width: auto; padding: 6px 12px; font-size: 13px; border-radius: 6px; }
    
    .movie-item { display: flex; align-items: center; gap: 15px; background: #1a1a1a; padding: 12px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #222; }
    .movie-item img { width: 45px; height: 65px; object-fit: cover; border-radius: 4px; background: #333; }
    .movie-item-info { flex-grow: 1; }
    .movie-item-info h3 { margin: 0; font-size: 15px; line-height: 1.2; margin-bottom: 5px; }
    .badge { font-size: 10px; background: #333; color: #00aeff; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; }
</style>
</head>
<body>

<div class="container">
    <div id="loginSection">
        <h1 style="color: #00aeff;">ADMIN LOGIN</h1>
        <p style="color: #888; margin-bottom: 25px;">‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö DUYDODEE-HD</p>
        
        <button class="btn btn-google" onclick="handleGoogleLogin()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google
        </button>

        <div class="divider">‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>

        <div class="input-group">
            <input type="email" id="loginEmail" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô">
        </div>
        <div class="input-group">
            <input type="password" id="loginPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
        </div>
        <button class="btn btn-primary" onclick="handleLogin()">‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
    </div>

    <div id="adminContent">
        <div class="header">
            <h2>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏ß‡πá‡∏ö</h2>
            <div style="text-align: right;">
                <span id="adminEmail" style="display: block; font-size: 12px; color: #00aeff; font-weight: 600;"></span>
                <button onclick="auth.signOut()" style="background:none; border:1px solid #444; color:#aaa; cursor:pointer; padding:5px 10px; border-radius:5px; margin-top: 5px;">Logout</button>
            </div>
        </div>

        <div class="form-card">
            <form id="movieForm">
                <div class="input-group">
                    <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</label>
                    <select id="category" required>
                        <option value="vertical">üì± ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á</option>
                        <option value="series">üé¨ ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢</option>
                        <option value="movie">üé• ‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
                    <input type="text" id="title" required placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏Å‡∏π‡πâ‡∏†‡∏±‡∏¢‡∏£‡∏±‡∏Å ‡∏ô‡∏±‡∏Å‡∏î‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏¥‡∏á">
                </div>
                <div class="input-group">
                    <label>URL ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå (‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á)</label>
                    <input type="url" id="poster" required placeholder="https://...">
                </div>
                <div class="input-group">
                    <label>URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube ‡∏õ‡∏Å‡∏ï‡∏¥)</label>
                    <input type="url" id="videoUrl" required placeholder="‡∏ß‡∏≠‡∏ô‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå Embed ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
                </div>
                <div class="input-group">
                    <label>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Badge (‡πÄ‡∏ä‡πà‡∏ô '‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß' ‡∏´‡∏£‡∏∑‡∏≠ 'EP.10')</label>
                    <input type="text" id="badge" placeholder="‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ">
                </div>
                <div class="input-group">
                    <label>‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠</label>
                    <textarea id="desc" rows="2"></textarea>
                </div>
                <button type="submit" class="btn btn-primary" id="submitBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</button>
            </form>
        </div>

        <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <div id="movieListContainer">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...</div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyAcCn0NGbakHmLEa_G47K8OepGaRqTV02Q",
      authDomain: "duydodeesport.firebaseapp.com",
      projectId: "duydodeesport",
      storageBucket: "duydodeesport.appspot.com",
      messagingSenderId: "435929814225",
      appId: "1:435929814225:web:fcb01803d9e5b77340e1f0"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©: ‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Embed ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    function formatVideoUrl(url) {
        if (url.includes('youtube.com/watch?v=')) {
            const videoId = url.split('v=')[1].split('&')[0];
            return `https://www.youtube.com/embed/${videoId}`;
        } else if (url.includes('youtu.be/')) {
            const videoId = url.split('youtu.be/')[1].split('?')[0];
            return `https://www.youtube.com/embed/${videoId}`;
        }
        return url; // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà YouTube ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô Embed ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°
    }

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
            document.getElementById('adminEmail').innerText = "Logged in as: " + user.email;
            loadData();
        } else {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('adminContent').style.display = 'none';
        }
    });

    async function handleGoogleLogin() {
        const provider = new firebase.auth.GoogleAuthProvider();
        try {
            await auth.signInWithPopup(provider);
        } catch (err) {
            if (err.code === 'auth/unauthorized-domain') {
                alert('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° "classic1990.github.io" ‡πÉ‡∏ô Firebase Console');
            } else {
                alert('Google Login Error: ' + err.message);
            }
        }
    }

    async function handleLogin() {
        const email = document.getElementById('loginEmail').value;
        const pass = document.getElementById('loginPassword').value;
        if(!email || !pass) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô');
        try { await auth.signInWithEmailAndPassword(email, pass); } catch (err) { alert('‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!'); }
    }

    document.getElementById('movieForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

        const rawUrl = document.getElementById('videoUrl').value;
        const formattedUrl = formatVideoUrl(rawUrl);

        const data = {
            category: document.getElementById('category').value,
            title: document.getElementById('title').value,
            poster: document.getElementById('poster').value,
            videoUrl: formattedUrl,
            badge: document.getElementById('badge').value,
            description: document.getElementById('desc').value,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        try {
            await db.collection('movies').add(data);
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Embed ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            e.target.reset();
        } catch (err) {
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err.message);
        } finally {
            btn.disabled = false;
            btn.innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö';
        }
    });

    function loadData() {
        db.collection('movies').orderBy('createdAt', 'desc').onSnapshot(snap => {
            const container = document.getElementById('movieListContainer');
            container.innerHTML = '';
            snap.forEach(doc => {
                const m = doc.data();
                const div = document.createElement('div');
                div.className = 'movie-item';
                div.innerHTML = `
                    <img src="${m.poster}" onerror="this.src='https://via.placeholder.com/50x75'">
                    <div class="movie-item-info">
                        <h3>${m.title}</h3>
                        <span class="badge">${m.category}</span>
                    </div>
                    <button class="btn-danger" onclick="deleteItem('${doc.id}')">‡∏•‡∏ö</button>
                `;
                container.appendChild(div);
            });
        });
    }

    window.deleteItem = async (id) => {
        if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?')) {
            try { await db.collection('movies').doc(id).delete(); } catch (err) { alert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); }
        }
    }
</script>
</body>
</html>
