<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | DUYDODEE-HD</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { margin: 0; font-family: 'Prompt', sans-serif; background: #0f0f0f; color: #fff; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        #loginSection { background: #1a1a1a; padding: 40px; border-radius: 20px; text-align: center; margin-top: 10vh; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        #adminContent { display: none; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .form-card { background: #1a1a1a; padding: 25px; border-radius: 15px; border: 1px solid #333; margin-bottom: 40px; position: relative; }
        .form-card.edit-mode { border-color: #00aeff; box-shadow: 0 0 15px rgba(0, 174, 255, 0.2); }
        .edit-label { display: none; color: #00aeff; font-weight: 600; margin-bottom: 10px; }
        .form-card.edit-mode .edit-label { display: block; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 8px; color: #aaa; font-size: 14px; }
        .input-group input, .input-group textarea, .input-group select { 
            box-sizing: border-box; width: 100%; padding: 12px; border-radius: 10px; 
            border: 1px solid #333; background: #222; color: #fff; font-size: 16px; 
            font-family: 'Prompt', sans-serif; 
        }
        .btn { padding: 12px 25px; border-radius: 10px; border: none; cursor: pointer; font-size: 16px; font-weight: 600; width: 100%; transition: 0.3s; }
        .btn-primary { background: #00aeff; color: #000; }
        .btn-primary:hover { background: #008ecc; }
        .btn-secondary { background: #333; color: #fff; margin-top: 10px; }
        .ai-btn { background: linear-gradient(45deg, #8b5cf6, #d946ef); border: none; padding: 8px 15px; border-radius: 8px; color: white; cursor: pointer; margin-top: 8px; font-size: 13px; display: inline-flex; align-items: center; gap: 8px; transition: 0.3s; }
        .loader { display: none; width: 14px; height: 14px; border: 2px solid #fff; border-bottom-color: transparent; border-radius: 50%; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .movie-item { display: flex; align-items: center; gap: 15px; background: #1a1a1a; padding: 12px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #222; }
        .movie-item img { width: 45px; height: 65px; object-fit: cover; border-radius: 4px; background: #333; }
        .movie-item-info { flex-grow: 1; }
        .badge { font-size: 10px; background: #333; color: #00aeff; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; }
        .btn-danger { background: #ff4444; color: #fff; padding: 6px 12px; border-radius: 6px; border:none; cursor:pointer; }
        .btn-edit { background: #ffcc00; color: #000; padding: 6px 12px; border-radius: 6px; border:none; cursor:pointer; margin-right:5px; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginSection">
        <h1 style="color: #00aeff;">ADMIN LOGIN</h1>
        <div class="input-group">
            <input type="email" id="loginEmail" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô">
        </div>
        <div class="input-group">
            <input type="password" id="loginPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
        </div>
        <button class="btn btn-primary" onclick="handleLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <div id="adminContent">
        <div class="header">
            <h2>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (Project: Classic)</h2>
            <button onclick="auth.signOut()" style="background:none; border:1px solid #444; color:#aaa; cursor:pointer; padding:5px 10px; border-radius:5px;">Logout</button>
        </div>

        <div class="form-card" id="formCard">
            <div class="edit-label">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á</div>
            <form id="movieForm">
                <input type="hidden" id="editId">
                <div class="input-group">
                    <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                    <select id="category" required>
                        <option value="vertical">üì± ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á</option>
                        <option value="series">üé¨ ‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå‡∏à‡∏µ‡∏ô‡∏û‡∏≤‡∏Å‡∏¢‡πå‡πÑ‡∏ó‡∏¢</option>
                        <option value="movie">üé• ‡∏†‡∏≤‡∏û‡∏¢‡∏ô‡∏ï‡∏£‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
                    <input type="text" id="title" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." required>
                </div>
                <div class="input-group">
                    <label>URL ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå</label>
                    <input type="url" id="poster" required placeholder="https://...">
                </div>
                <div class="input-group">
                    <label>URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á (‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube ‡∏´‡∏£‡∏∑‡∏≠ Code ‡∏ù‡∏±‡∏á‡∏Å‡πá‡πÑ‡∏î‡πâ)</label>
                    <input type="text" id="videoUrl" required placeholder="‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≤‡∏Å YouTube">
                </div>
                <div class="input-group">
                    <label>‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠</label>
                    <textarea id="desc" rows="4"></textarea>
                    <button type="button" class="ai-btn" id="generateAI">
                        <span class="loader" id="aiLoader"></span>
                        <i class="fas fa-magic"></i> AI ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠
                    </button>
                </div>
                <button type="submit" class="btn btn-primary" id="submitBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button type="button" class="btn btn-secondary" id="cancelBtn" style="display:none;" onclick="resetForm()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </form>
        </div>

        <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h3>
        <div id="movieListContainer">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

<script>
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ä‡∏∏‡∏î "Classic" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß
    const firebaseConfig = {
        apiKey: "AIzaSyBuhTA1YwcsNyxR0NLYW6JrxUQ9U7vyVeo",
        authDomain: "classic-e8ab7.firebaseapp.com",
        projectId: "classic-e8ab7",
        storageBucket: "classic-e8ab7.firebasestorage.app",
        messagingSenderId: "596308927760",
        appId: "1:596308927760:web:63043fd2786459082cb195",
        measurementId: "G-RCDSPGQ5LE"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const geminiKey = "‡∏ß‡∏≤‡∏á_API_KEY_GEMINI_‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ"; 

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    function formatVideoUrl(url) {
        if (!url) return "";
        if (url.includes('<iframe')) {
            const match = url.match(/src=["']([^"']+)["']/);
            if (match && match[1]) url = match[1];
        }
        if (url.includes('/shorts/')) {
            const videoId = url.split('/shorts/')[1].split('?')[0];
            return `https://www.youtube.com/embed/${videoId}?autoplay=1`;
        }
        if (url.includes('v=')) {
            const videoId = url.split('v=')[1].split('&')[0];
            return `https://www.youtube.com/embed/${videoId}?autoplay=1`;
        }
        if (url.includes('youtu.be/')) {
            const videoId = url.split('youtu.be/')[1].split('?')[0];
            return `https://www.youtube.com/embed/${videoId}?autoplay=1`;
        }
        return url;
    }

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
    async function handleLogin() {
        const email = document.getElementById('loginEmail').value;
        const pass = document.getElementById('loginPassword').value;
        try { await auth.signInWithEmailAndPassword(email, pass); } catch (err) { alert('‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Email/Password'); }
    }

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
            loadData();
        } else {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('adminContent').style.display = 'none';
        }
    });

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    document.getElementById('movieForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const editId = document.getElementById('editId').value;
        const data = {
            category: document.getElementById('category').value,
            title: document.getElementById('title').value,
            poster: document.getElementById('poster').value,
            videoUrl: formatVideoUrl(document.getElementById('videoUrl').value),
            description: document.getElementById('desc').value,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        try {
            if (editId) {
                await db.collection('movies').doc(editId).update(data);
            } else {
                data.views = 0;
                data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                await db.collection('movies').add(data);
            }
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            resetForm();
        } catch (err) { alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message); }
    });

    function loadData() {
        db.collection('movies').orderBy('createdAt', 'desc').onSnapshot(snap => {
            const container = document.getElementById('movieListContainer');
            container.innerHTML = '';
            snap.forEach(doc => {
                const m = doc.data();
                const div = document.createElement('div');
                div.className = 'movie-item';
                div.innerHTML = `
                    <img src="${m.poster}" onerror="this.src='logo.png'">
                    <div class="movie-item-info">
                        <strong>${m.title}</strong><br>
                        <span class="badge">${m.category}</span>
                    </div>
                    <div>
                        <button class="btn-edit" onclick='startEdit("${doc.id}", ${JSON.stringify(m).replace(/'/g, "&apos;")})'>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button class="btn-danger" onclick="deleteItem('${doc.id}')">‡∏•‡∏ö</button>
                    </div>
                `;
                container.appendChild(div);
            });
        });
    }

    function resetForm() {
        document.getElementById('movieForm').reset();
        document.getElementById('editId').value = '';
        document.getElementById('submitBtn').innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        document.getElementById('cancelBtn').style.display = 'none';
        document.getElementById('formCard').classList.remove('edit-mode');
    }

    window.startEdit = (id, data) => {
        document.getElementById('editId').value = id;
        document.getElementById('category').value = data.category;
        document.getElementById('title').value = data.title;
        document.getElementById('poster').value = data.poster;
        document.getElementById('videoUrl').value = data.videoUrl;
        document.getElementById('desc').value = data.description || '';
        document.getElementById('submitBtn').innerText = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        document.getElementById('cancelBtn').style.display = 'block';
        document.getElementById('formCard').classList.add('edit-mode');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    window.deleteItem = async (id) => { if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?')) await db.collection('movies').doc(id).delete(); }

</script>
</body>
</html>
